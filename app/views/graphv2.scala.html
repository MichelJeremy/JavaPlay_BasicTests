@(list: List[String])

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>WHAT ARE YOU DOING STALKER</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">
        <script src="@routes.Assets.versioned("javascripts/amcharts/amcharts.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/amcharts/serial.js")" type="text/javascript"></script>
        <script src="@routes.Assets.versioned("javascripts/amcharts/themes/light.js")" type="text/javascript"></script>
    </head>
    
    <body>
        <h1>Graph</h1>
        
        <!-- div for graph content-->
        <div id="chartdiv" style="width: 100%; height: 500px;"></div>
        
        <!-- Create two empty Object array and append as much unmutable array to it as there are values in the cvs document-->

        <script type="text/javascript">
            //First, let's see how many sensors there are
            var listOfSensorId = [];
            var alreadyExists = false;
            var i;
            // goes through every members of the data arraylist
            @for(l <- 0 until list.size) {
                // checks every 4 members, except the ery first which is text (= every Ids)
                
                @if(l%4 == 0 && l != 0) {
                    // checks every embers of listofSensorId
                    for(i = 0; i < listOfSensorId.length; i++) {
                        // if the list members exists in listofsensorsId, go to next value
                        if(@list.get(l) == listOfSensorId[i]) {
                            alreadyExists = true;
                        }
                    }
                    // if the data list member didn't exist in the sensor list, add it in
                    if (alreadyExists == false) {
                        listOfSensorId.push(@list.get(l));
                    // Finally, we reset already exist to test the next value
                    } else {
                        alreadyExists = false;                    
                    }
                }
            }
            
            // We get the number of sensors
            var nbrOfSensors = listOfSensorId.length;

            //Now, we dynamically create as much chartData var as there are sensors
            for (i = 1; i < nbrOfSensors+1; i++) {
                eval("var chartData" + i + " = []");
            }
            
            var id;
            var dateMinus;
            var newDate;
            var newDateSpl;
            var time;
            var value;
             
            // THis could be optimized by parsing this data at the same time as we counted the number of different IDs sooner
            @for(l <- 4 until list.size) {
                @if(l%4 == 0) {
                    // Here we have an ID
                    id = @list.get(l);
                }
                @if(l%4 == 1) {
                    // Here we have a date
                    dateMinus = "@list.get(l)";
                }
                @if(l%4 == 2) {
                    // Here we have a time
                    time = "@list.get(l)".slice(0,-3);
                    
                    // get the date to the correct format "YYYY-DD-MM HH:MM"
                    newDate = dateMinus + " " + time;
                    newDateSpl = newDate.split(/[\s:-]+/);
                    var finalDate = new Date(newDateSpl[0], newDateSpl[2], newDateSpl[1], newDateSpl[3], newDateSpl[4], 0, 0);
                }
                @if(l%4 == 3) {
                    // Here we have the value
                    value = @list.get(l);
                    
                    // Now that we got every values needed, we can push the data in the correct array
                    eval("chartData" + id + ".push({\
                         date: " + "finalDate" +",\
                         tonsOfBananas: " + value +"\
                         });");
                }
            }                            
                        // Initiate chart creation
            // amChart configuration
            var chart = AmCharts.makeChart("chartdiv", {
                "type": "serial",
                "theme": "light",
                "marginRight": 80,
                "autoMarginOffset": 20,
                "marginTop": 7,
                "dataProvider": chartData1,
                "valueAxes": [{
                    "axisAlpha": 0.2,
                    "dashLength": 1,
                    "position": "left"
                }],
                "mousewheelZoomEnabled": true,
                "graphs": [{
                    "id": "g1",
                    "balloonText": "[[value]]",
                    "bullet": "round",
                    "bulletBorderAlpha": 1,
                    "bulletColor": "#FFFFFF",
                    "hideBulletsCount": 50,
                    "title": "red line",
                    "valueField": "tonsOfBananas",
                    "useLineColorForBulletBorder": true,
                    "balloon":{
                        "drop":true
                    }
                }],
                "chartScrollbar": {
                    "autoGridCount": true,
                    "graph": "g1",
                    "scrollbarHeight": 40
                },
                "chartCursor": {
                    "categoryBalloonDateFormat": "YYYY-MM-DD, HH:MM",
                   "limitToGraph":"g1"
                    
                },
                "categoryField": "date",
                "categoryAxis": {
                    "minPeriod": "hh",
                    "parseDates": true,
                    "axisColor": "#DADADA",
                    "dashLength": 1,
                    "minorGridEnabled": true
                },
                "export": {
                    "enabled": true
                }
            });
            
            chart.addListener("rendered", zoomChart);
            zoomChart();
            
            //definition of zoom function for supah dupah zoom
            function zoomChart() {
                chart.zoomToIndexes(chartData1.length - 40, chartData1.length - 1);
            }                            
            
        </script>
        
    </body>
</html>